server:
  host: 0.0.0.0
  port: 3037
  debug: false
  workers: 4
  log_level: info

streaming:
  format: mpegts
  queue_size: 100
  timeout: 5000000
  default_profile: h264_nvenc
  reconnect: true

profiles:
  h264_nvenc:
    name: NVIDIA H.264 (NVENC)
    codec: h264_nvenc
    ffmpeg_args: >
      ffmpeg -hide_banner -loglevel error -fflags +genpts+discardcorrupt+igndts
      -reconnect 1 -reconnect_streamed 1 -reconnect_delay_max 60 -rw_timeout 5000000
      -timeout 5000000 -probesize 1000000 -analyzeduration 1000000
      -hwaccel cuda -hwaccel_output_format cuda -threads 0 -thread_queue_size 8192
      -re -i {streamUrl}
      -map 0:v:0 -map 0:a:0? -map 0:s? -c:v h264_nvenc -preset fast -tune ull
      -profile:v high -level:v 4.1 -g 50 -bf 2 -rc vbr_hq -cq 23 -rc-lookahead 20
      -b:v 6000k -maxrate 7500k -bufsize 12000k
      -no-scenecut 1 -spatial-aq 1 -temporal-aq 1 -aq-strength 10
      -c:a aac -b:a 128k -ac 2 -af aresample=async=0 -vsync 1
      -f mpegts -muxrate 0 -muxdelay 0.05 -mpegts_flags +initial_discontinuity
      -bsf:v h264_mp4toannexb pipe:1

  hevc_nvenc:
    name: NVIDIA HEVC (NVENC)
    codec: hevc_nvenc
    ffmpeg_args: >
      ffmpeg -hide_banner -loglevel error -fflags +genpts+discardcorrupt+igndts
      -reconnect 1 -reconnect_streamed 1 -reconnect_delay_max 60 -rw_timeout 5000000
      -timeout 5000000 -probesize 1000000 -analyzeduration 1000000
      -hwaccel cuda -hwaccel_output_format cuda -threads 0 -thread_queue_size 8192
      -re -i {streamUrl}
      -map 0:v:0 -map 0:a:0? -map 0:s? -c:v hevc_nvenc -preset p1 -tune ull
      -profile:v main -level:v 5.1 -g 50 -bf 2 -rc vbr -cq 25 -rc-lookahead 20
      -b:v 6000k -maxrate 7500k -bufsize 12000k
      -no-scenecut 1 -spatial-aq 1 -temporal-aq 1 -aq-strength 10
      -c:a aac -b:a 128k -ac 2 -af aresample=async=0 -vsync 1
      -f mpegts -muxrate 0 -muxdelay 0.05 -mpegts_flags +initial_discontinuity
      -bsf:v hevc_mp4toannexb pipe:1

  libx264:
    name: Software H.264
    codec: libx264
    ffmpeg_args: >
      ffmpeg -hide_banner -loglevel error -fflags +genpts+discardcorrupt+igndts
      -reconnect 1 -reconnect_streamed 1 -reconnect_delay_max 60 -rw_timeout 5000000
      -timeout 5000000 -probesize 1000000 -analyzeduration 1000000
      -threads 2 -thread_queue_size 8192
      -re -i {streamUrl}
      -map 0:v:0 -map 0:a:0? -map 0:s? -c:v libx264 -preset veryfast -tune zerolatency
      -g 50 -bf 2 -b:v 6000k -maxrate 7500k -bufsize 12000k
      -c:a aac -b:a 128k -ac 2 -af aresample=async=0 -vsync 1
      -f mpegts -muxrate 0 -muxdelay 0.05 -mpegts_flags +initial_discontinuity
      -bsf:v h264_mp4toannexb pipe:1

  h264_qsv:
    name: Intel Quick Sync (H.264 QSV)
    codec: h264_qsv
    ffmpeg_args: >
      ffmpeg -hide_banner -loglevel error -fflags +genpts+discardcorrupt+igndts
      -reconnect 1 -reconnect_streamed 1 -reconnect_delay_max 60 -rw_timeout 5000000
      -timeout 5000000 -probesize 1000000 -analyzeduration 1000000
      -hwaccel qsv -threads 0 -thread_queue_size 8192
      -re -i {streamUrl}
      -map 0:v:0 -map 0:a:0? -map 0:s? -c:v h264_qsv -preset veryfast -g 50
      -b:v 6000k -maxrate 7500k -bufsize 12000k
      -c:a aac -b:a 128k -ac 2 -af aresample=async=0 -vsync 1
      -f mpegts -muxrate 0 -muxdelay 0.05 -mpegts_flags +initial_discontinuity
      -bsf:v h264_mp4toannexb pipe:1

  h264_vaapi:
    name: VAAPI H.264
    codec: h264_vaapi
    ffmpeg_args: >
      ffmpeg -hide_banner -loglevel error -fflags +genpts+discardcorrupt+igndts
      -reconnect 1 -reconnect_streamed 1 -reconnect_delay_max 60 -rw_timeout 5000000
      -timeout 5000000 -probesize 1000000 -analyzeduration 1000000
      -hwaccel vaapi -vaapi_device /dev/dri/renderD128 -threads 0 -thread_queue_size 8192
      -re -i {streamUrl}
      -map 0:v:0 -map 0:a:0? -map 0:s? -vf 'format=nv12,hwupload' -c:v h264_vaapi
      -qp 23 -g 50 -b:v 6000k -maxrate 7500k -bufsize 12000k
      -c:a aac -b:a 128k -ac 2 -af aresample=async=0 -vsync 1
      -f mpegts -muxrate 0 -muxdelay 0.05 -mpegts_flags +initial_discontinuity
      -bsf:v h264_mp4toannexb pipe:1
